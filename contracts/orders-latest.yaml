dataContractSpecification: 1.0.0
id: orders-latest
info:
  title: Orders Latest
  version: 1.0.0
  description: |
    Customer order events published to the orders-latest Kafka topic.
    This contract defines the schema and quality expectations for order data.
  owner: Data Platform Team
  contact:
    name: Platform Team
    email: platform@example.com

servers:
  production:
    type: kafka
    host: kafka.production.example.com:9092
    topic: orders-latest
    format: json

models:
  orders:
    description: Individual customer order events
    type: table
    fields:
      order_id:
        type: text
        description: Unique identifier for the order
        required: true
        unique: true
        example: "ORD-12345"

      order_timestamp:
        type: long
        description: When the order was placed (Unix timestamp in milliseconds)
        required: true
        format: unix_epoch_ms
        example: 1705318200000
        quality:
          - type: range
            description: Timestamp must be in milliseconds (reasonable range)
            min: 1000000000000
            max: 9999999999999
          - type: freshness
            description: Events should be recent (within 24 hours)
            maxAge: 24h

      order_status:
        type: text
        description: Current status of the order
        required: true
        enum:
          - PENDING
          - CONFIRMED
          - SHIPPED
          - DELIVERED
          - CANCELLED
        enum_evolution: strict
        example: "CONFIRMED"

      order_total:
        type: long
        description: Total order amount in cents
        required: true
        example: 29999
        quality:
          - type: range
            description: Order total should be between $10 and $499
            min: 1000
            max: 49900
          - type: positive
            description: Amount must be positive
            min: 1

      metadata:
        type: object
        description: Optional metadata (JSON object). Do not include PII or sensitive data such as passwords, tokens, credit cards, or national IDs.
        required: false
        pii_risk: high
        example: {"source": "mobile_app", "version": "2.1.0"}

      customer_id:
        type: text
        description: Unique identifier for the customer
        required: true
        example: "CUST-67890"

      customer_email_address:
        type: text
        format: email
        description: Customer's email address
        required: true
        pii: true
        classification: sensitive
        example: "customer@example.com"

      processed_timestamp:
        type: timestamp
        description: When the order was processed by the system
        required: true
        example: "2024-01-15T10:30:05Z"

quality:
  type: SodaCL
  specification: |
    checks for orders:
      - row_count > 0
      - duplicate_count(order_id) = 0
      - missing_count(customer_email_address) = 0
      - invalid_count(customer_email_address) = 0:
          valid format: email
      - freshness(order_timestamp) < 1h

servicelevels:
  availability:
    description: Topic availability SLA
    percentage: 99.9%

  retention:
    description: Message retention period
    period: 7 days
    unlimited: false

  latency:
    description: End-to-end latency from order placement to topic
    threshold: 5s
    percentile: 0.95

terms:
  usage: |
    This topic contains customer order data and must be handled according to
    data privacy regulations. PII fields must be encrypted at rest and in transit.

  limitations: |
    - Historical data available for 7 days
    - Quality checks run hourly
    - Breaking changes require platform team approval

tags:
  - orders
  - customer-data
  - pii
  - production
